- name: "Copy deployment check script"
  copy:
    src: "check_deployment.sh"
    dest: "/root/check_deployment.sh"
    mode: "0755"

- name: Install Pip3
  apt:
    name: python3-pip
    update_cache: yes

- name: Install kubernetes pre requisites
  pip:
    name: 
      - kubernetes

- name: Add a reloader helm repository
  kubernetes.core.helm_repository:
    name: stakater
    repo_url: https://stakater.github.io/stakater-charts

- name: Add a daas helm repository
  kubernetes.core.helm_repository:
    name: daas
    repo_url: https://oci-sunbird.github.io/daas-helm

- name: Add a longhorn helm repository
  kubernetes.core.helm_repository:
    name: longhorn
    repo_url: https://charts.longhorn.io

- name: Add a cloud native postgres helm repository
  kubernetes.core.helm_repository:
    name: cnpg
    repo_url: https://cloudnative-pg.github.io/charts

- name: Add hashicorp helm repository
  kubernetes.core.helm_repository:
    name: hashicorp
    repo_url: https://helm.releases.hashicorp.com

- name: Add elasticsearch helm repository
  kubernetes.core.helm_repository:
    name: elastic
    repo_url: https://helm.elastic.co

- name: Create project directories
  file:
    path: "{{item}}"
    state: directory
    mode: '0755'
  with_items:
    - /root/sunbird-rc/customization
    - /root/sunbird-rc/customization/longhorn
    - /root/sunbird-rc/customization/postgres
    - /root/sunbird-rc/customization/vault
    - /root/sunbird-rc/customization/filestorage
    - /root/sunbird-rc/customization/keycloak
    - /root/sunbird-rc/customization/registry

- name: Create a k8s namespace
  kubernetes.core.k8s:
    name: sunbird-rc
    api_version: v1
    kind: Namespace
    state: present
